"use strict";angular.module("gameFlowApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]),angular.module("gameFlowApp").controller("MainCtrl",["$scope","GameData",function(a,b){b.get().then(function(b){a.gameData=b}),a.playDetails={"final":!0,homeScore:115,awayScore:120,description:"Hover the game event markers below for play-by-play details"},a.setPlayDetails=function(b,c){var d=c.target,e=d.getAttribute("transform");if(null!==e){var f=e+"translate(0, 30)";d.setAttribute("transform",f)}d.setAttribute("stroke-width",6),a.playDetails["final"]=!1,a.playDetails=b},a.resetMarker=function(a){var b=a.target,c=b.getAttribute("transform");if(null!==c){var d=c.replace(/translate\(.*\)/,"");b.setAttribute("transform",d)}b.setAttribute("stroke-width",1)}}]),angular.module("gameFlowApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("gameFlowApp").factory("GameData",["$http","GameDataParser",function(a,b){return{get:function(){return a.get("games/game2.json").then(function(a){return b.parse(a.data)})}}}]),angular.module("gameFlowApp").factory("GameDataParser",["strToSec",function(a){return{parse:function(b){var c,d,e,f,g=2,h=4,i=6,j=7,k=8,l=9,m=10,n=12,o=5,p=60;c=b.resultSets[0].rowSet,d=c[c.length-1][h],e=function(a){var b=4*n*p;return a>4&&(b+=(a-4)*(o*p)),b}(d);var q=function(a){for(var b={},c=1;a>=c;c++)5>c?(b["Q"+c]={},b["Q"+c].start=720*c-720,b["Q"+c].length=720):(b["OT"+(c-4)]={},b["OT"+(c-4)].start=2880+300*(c-4)-300,b["OT"+(c-4)].length=300);return console.log(b),b};f={gameId:c[0][0],periods:q(d),totalGameTime:e,largestLead:0,events:[]};for(var r=0,s=0,t=0,u=function(a){return a.period>4?(4*n+(a.period-4)*o)*p-a.gameClock:a.period*n*p-a.gameClock},v=function(a){for(var b,c=[a[j],a[k],a[l]],d=0;d<c.length;d++)c[d]&&(b?b+=", "+c[d]:b=c[d]);return b},w=0,x=0;x<c.length;x++){var y,z;if(y=c[x],y[m]&&12!==y[g]&&13!==y[g]){f.events[w]={},z=f.events[w],w++,z.period=y[h],z.gameClock=a(y[i]),z.totalElaspsedSeconds=u(z),z.description=v(y);var A,B;A=y[m].split(" - "),s=A[0],r=A[1],z.homeScore=r,z.awayScore=s,z.margin=s-r,B=Math.abs(z.margin),B>t&&(t=B)}}return f.largestLead=t,f}}}]),angular.module("gameFlowApp").factory("strToSec",function(){return function(a){var b=a.split(":");return 60*parseInt(b[0])+parseInt(b[1])}}),angular.module("gameFlowApp").filter("homeLeads",function(){return function(a){return a>=0?0:a}}),angular.module("gameFlowApp").filter("abs",function(){return function(a){return Math.abs(a)}}),angular.module("gameFlowApp").filter("secToStr",function(){return function(a){var b=a%60;10>b&&(b="0"+b);var c=parseInt(a/60);return c+":"+b}}),angular.module("gameFlowApp").filter("formatPeriod",function(){return function(a){var b;if(4>=a)b="Q"+a;else{var c=a-4;b="OT"+c}return b}}),angular.module("gameFlowApp").factory("EventMarkerSettings",function(){var a,b,c;return{setSVGParams:function(){},multiplier:function(){return a},setMultiplier:function(b){a=b},circularDecorationDiam:function(){return b},setCircularDecorationDiam:function(a){b=a},bufferSize:function(){return c},setBufferSize:function(a){c=a}}}),angular.module("gameFlowApp").filter("fixAspectRatio",["EventMarkerSettings",function(a){return function(b){if(!b)return"0 0 0 0";var c,d,e,f,g,h,i;h={width:2,height:1},g=2*b.largestLead,e=b.totalGameTime,f=e*h.height/h.width,i=f/g,c=0,d=-b.largestLead*i;var j=50;return a.setMultiplier(i),a.setCircularDecorationDiam(7*i/16),a.setBufferSize(j),[c-j,d-j,e+2*j,f+2*j].join(" ")}}]).filter("arcLeftEndpoint",["EventMarkerSettings",function(a){return function(b){return[b.totalElaspsedSeconds-a.circularDecorationDiam(),Math.abs(b.margin)*a.multiplier()].join(" ")}}]).filter("arc",["EventMarkerSettings",function(a){return function(b){return[a.circularDecorationDiam(),a.circularDecorationDiam(),0,1,0,b.totalElaspsedSeconds+a.circularDecorationDiam(),Math.abs(b.margin)*a.multiplier()].join(", ")}}]).filter("scale",["EventMarkerSettings",function(a){return function(b){return b*a.circularDecorationDiam()}}]).filter("setDirection",function(){return function(a){return a.margin<=0?"rotate(180 "+a.totalElaspsedSeconds+" 0)":""}}).filter("graphHeight",["EventMarkerSettings",function(a){return function(b){return b?b.largestLead*a.multiplier()+a.bufferSize():"0"}}]),angular.module("gameFlowApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/main.html",'<div class="jumbotron clearfix"> <p class="lead"> Grizzlies @ 76ers, 13 Dec 2014 </p> <div class="scoreboard"> <div class="versus"> @ </div> <div class="row"> <div class="col-md-3"> <svg class="away-team-logo" width="100%" viewbox="0 0 160 160"> <use xlink:href="images/sprites.fd6602e4.svg#grizzlies-logo"> </svg> </div> <div class="col-md-6"> <div class="row"> <div class="col-md-5"> <div class="scoreboard-item score"> {{playDetails.awayScore}} </div> </div> <div class="col-md-5 col-md-offset-2"> <div class="scoreboard-item score"> {{playDetails.homeScore}} </div> </div> </div> <div class="row period-and-clock"> <div ng-show="playDetails.gameClock"> <div class="col-md-4 col-md-offset-2"> <div class="scoreboard-item period"> {{playDetails.period | formatPeriod}} </div> </div> <div class="col-md-4"> <div class="scoreboard-item clock"> {{playDetails.gameClock | secToStr}} </div> </div> </div> <div ng-show="playDetails.final"> FINAL </div> </div> </div> <div class="col-md-3"> <svg class="home-team-logo" width="100%" viewbox="0 0 160 160"> <use xlink:href="images/sprites.fd6602e4.svg#sixers-logo"> </svg> </div> <div class="col-md-12 play-description"> {{playDetails.description}} </div> </div> </div> </div> <div id="graph"> <div class="home-team-leads">76ers lead</div> <svg width="100%" height="100%" ng-attr-view_box="{{gameData | fixAspectRatio}}" preserveaspectratio="xMaxYMid"> <line x1="0" y1="0" ng-attr-x2="{{gameData.totalGameTime}}" y2="0"> <g ng-repeat="(period, info) in gameData.periods"> <rect ng-attr-x="{{info.start}}" ng-attr-y="-{{gameData | graphHeight}}" ng-attr-width="{{info.length}}" height="100%" fill="none" stroke="#eed" stroke-width="5"> <text ng-attr-x="{{info.start + info.length / 2}}" ng-attr-y="{{-(gameData | graphHeight) + 100}}" style="font-family: source-code-pro;\n                   font-size  : 100;\n                   fill       : #eed;\n                   stroke     : none" text-anchor="middle">{{period}}</text> </g> <g ng-repeat="play in gameData.events" ng-mouseenter="setPlayDetails(play, $event)" ng-mouseleave="resetMarker($event)" stroke="#222"> <circle class="home" ng-attr-cx="{{play.totalElaspsedSeconds}}" cy="0" ng-attr-r="{{1 | scale}}" ng-show="play.margin === 0"> <circle ng-attr-cx="{{play.totalElaspsedSeconds}}" cy="0" ng-attr-r="{{1 | scale}}" class="away" ng-show="play.margin === 0"> <path ng-attr-d=" M {{play.totalElaspsedSeconds}} 0\n                        L {{play | arcLeftEndpoint}}\n                        A {{play | arc}}\n                        Z" ng-attr-transform="{{play | setDirection}}" ng-class="{home: play.margin < 0, away: play.margin > 0}" ng-hide="play.margin === 0"> </g> </svg> <div class="away-team-leads">Grizzlies lead</div> </div>')}]);